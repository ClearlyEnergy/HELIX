<div class="page_header_container">
    <div class="page_header">
        <div class="left page_action_container"></div>
        <div class="page_title">
            <h1>{$:: username $}</h1>
        </div>
        <div class="right page_action_container"></div>
    </div>
</div>
<div class="section_nav_container">
    <div class="section_nav" ng-include="::urls.static_url + 'seed/partials/profile_nav.html'"></div>
</div>
<div class="display">
    <div class="section">
        <div class="section">
            <div class="alert {$ alert.css $}" ng-show="alert.show">
                {$ alert.message $}
            </div>
            <div class="section_header_container has_btm_margin">
                <div class="section_header">
                    <h2><i class="fa fa-users"></i> {$:: 'Create an organization' | translate $}</h2>
                </div>
            </div>
            <div class="section_content_container org_form container-fluid">
                <div class="section_content">
                    <form name="orgForm" novalidate class="form-horizontal css-form" role="form">
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="org_name" translate>Organization Name:</label>
                            <div class="col-sm-4">
                              <input type="text" class="form-control" id="org_name" ng-model="org.name" placeholder="{$:: 'Organization Name' | translate $}" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="user_emails" translate>User E-mail:</label>
                            <div class="col-sm-4">
                                <select class="form-control" name="user_emails" id="user_emails" ng-options="u as u.email for u in org.users | orderBy:'email'" ng-model="org.email"> </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button class="btn btn-default" type="reset" ng-click="org_form.reset()" translate>Reset</button>
                                <button class="btn btn-primary" type="submit" ng-click="org_form.add(org)" ng-disabled="orgForm.$invalid || org_form.not_ready()" translate>Create</button>
                            </div>
                        </div>
                    </form>
                    <div ng-show="org_form.invalid">{$:: 'Error' | translate $}: <span>{$ org_form.message | translate $}</span>
                    </div>
                </div>
            </div>
            <div class="section_header_container has_btm_margin">
                <div class="section_header">
                    <h2><i class="fa fa-user"></i> {$:: 'Create a user' | translate $}</h2>
                </div>
            </div>
            <div class="section_content_container user_admin container-fluid">
                <div class="section_content">
                    <form name="userForm" novalidate class="form-horizontal css-form" role="form">
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="first_name" translate>User First Name:</label>
                            <div class="col-sm-4">
                              <input type="text" id="first_name" class="form-control" ng-model="user.first_name" placeholder="{$:: 'First Name' | translate $}" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="last_name" translate>User Last Name:</label>
                            <div class="col-sm-4">
                              <input type="text" id="last_name" class="form-control" ng-model="user.last_name" placeholder="{$:: 'Last Name' | translate $}" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="user_email" translate>User E-mail:</label>
                            <div class="col-sm-4">
                              <input type="email" id="user_email" class="form-control" ng-model="user.email" placeholder="{$:: 'User Email' | translate $}" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="role" translate>User Role:</label>
                            <div class="col-sm-4">
                                <select name="new_user_role" class="form-control" id="role" ng-options="role as role.name for role in roles" ng-model="user.role"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="new_user_org_select" translate>Choose Existing Organization:</label>
                            <div class="col-sm-4">
                                <select name="new_user_orgs" class="form-control" id="orgs" ng-options="o as o.name for o in org_user.organizations" ng-model="user.organization"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="org_name_from_user" translate>Or Create New (With User as Head):</label>
                            <div class="col-sm-4">
                              <input type="text" class="form-control" id="new_user_org_name" ng-model="user.org_name" placeholder="{$:: 'Organization Name' | translate $}">
                            </div>

                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button class="btn btn-default" type="reset" ng-click="user_form.reset()" translate>Reset</button>
                                <button class="btn btn-primary" type="submit" ng-click="user_form.add(user)" ng-disabled="userForm.$invalid" translate>Create</button>
                            </div>
                        </div>
                    </form>
                    <div ng-show="user_form.invalid">{$:: 'Error' | translate $}: <span>{$ user_form.message | translate $}</span>
                    </div>
                </div>
            </div>
            <div class="section_header_container has_btm_margin">
                <div class="section_header">
                    <h2><i class="fa fa-plus-circle"></i> {$:: 'Add/Remove a user to an organization' | translate $}</h2>
                </div>
            </div>
            <div class="section_content_container org_user_admin container-fluid">
                <div class="section_content row">
                    <div class="col-sm-6">
                        <form name="addRemoveForm" novalidate class="form-horizontal css-form" role="form">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="orgs">{$:: 'Organizations' | translate $}:</label>
                                <div class="col-sm-8">
                                    <select name="orgs" class="form-control" id="orgs" ng-options="o as o.name for o in org_user.organizations" ng-model="org_user.organization" ng-change="get_organizations_users(org_user.organization)"></select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="add_emails">{$:: 'Add user to organization' | translate $}:</label>
                                <div class="col-sm-8">
                                    <select name="user_emails" class="form-control" id="user_emails" ng-options="u as u.email for u in org.users | orderBy:'email'" ng-model="org_user.user"></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-4 col-sm-8">
                                    <button class="btn btn-primary" type="submit" ng-click="org_user.add()" translate>Add user</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="table_list_container col-sm-5">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th translate>User</th>
                                    <th></th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="user in org_user.users">
                                    <td>{$:: user.email $}</td>
                                    <td>
                                        <button class="btn btn-default" type="submit" ng-click="org_user.remove_user(user.user_id, org_user.organization.org_id)" translate>Remove User</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="section_header_container has_btm_margin">
                <div class="section_header">
                    <h2><i class="fa fa-leaf"></i> Add Home Energy Score ID</h2>
                </div>
            </div>
            <div class="section_content_container org_hes_admin container-fluid">
                <div class="section_content">
                        <form name="orgHes" novalidate class="form-horizontal css-form" role="form">
	                        <div class="form-group">
                                <label class="col-sm-2 control-label" for="hes_orgs">{$:: 'Organizations' | translate $}:</label>
                                <div class="col-sm-4">
                                    <select name="orgs" class="form-control" id="orgs" ng-options="o as o.name for o in org_user.organizations" ng-model="org_hes.organization"></select>
                                </div>
                            </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_hes_id">Home Energy Score ID:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_hes_id" ng-model="org_hes.hes" placeholder="Home Energy Score ID, for example TST">
	                            </div>
                            </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_hes_partner_name">Home Energy Score Partner ID:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_hes_partner_name" ng-model="org_hes.hes_partner_name" placeholder="ID for 3rd party recipient, for example HELIX-TST">
	                            </div>
                            </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_hes_partner_password">Home Energy Score Partner Password:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_hes_partner_password" ng-model="org_hes.hes_partner_password" placeholder="Password for 3rd party recipient account">
	                            </div>
	                        </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_hes_start_date">Start Date:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_hes_start_date" ng-model="org_hes.hes_start_date" placeholder="Date to start data retrieval (YYYY-mm-dd)">
	                            </div>
	                        </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_hes_end_date">End Date:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_hes_end_date" ng-model="org_hes.hes_end_date" placeholder="Date to end data retrieval (YYYY-mm-dd)">
	                            </div>
	                        </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button class="btn btn-primary" type="submit" ng-click="org_hes.add(org_hes)">Add ID</button>
                                </div>
                            </div>
                        </form>
                    </div>
				</div>					

            <div class="section_header_container has_btm_margin">
                <div class="section_header">
                    <h2><i class="fa fa-leaf"></i> Add LEED Information</h2>
                </div>
            </div>
            <div class="section_content_container org_leed_admin container-fluid">
                <div class="section_content">
                        <form name="orgLeed" novalidate class="form-horizontal css-form" role="form">
	                        <div class="form-group">
                                <label class="col-sm-2 control-label" for="leed_orgs">{$:: 'Organizations' | translate $}:</label>
                                <div class="col-sm-4">
                                    <select name="orgs" class="form-control" id="orgs" ng-options="o as o.name for o in org_user.organizations" ng-model="org_leed.organization"></select>
                                </div>
                            </div>							
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_leed_geo_id">LEED Geographic Identifier:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_leed_geo_id" ng-model="org_leed.leed_geo_id" placeholder="LEED Geographic Identifier, for example 6611 for Vermont">
	                            </div>
                            </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_leed_start_date">Start Date:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_leed_start_date" ng-model="org_leed.leed_start_date" placeholder="Date to start data retrieval (YYYY-mm-dd)">
	                            </div>
	                        </div>
	                        <div class="form-group">
	                            <label class="col-sm-2 control-label" for="org_leed_end_date">End Date:</label>
	                            <div class="col-sm-4">
	                                <input type="text" class="form-control" id="org_leed_end_date" ng-model="org_leed.leed_end_date" placeholder="Date to end data retrieval (YYYY-mm-dd)">
	                            </div>
	                        </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button class="btn btn-primary" type="submit" ng-click="org_leed.add(org_leed)">Add Geographic ID</button>
                                </div>
                            </div>
                        </form>
                    </div>
				</div>	

            <div class="section_header_container has_btm_margin">
                <div class="section_header">
                    <h2><i class="fa fa-trash-o"></i> {$:: 'Remove inventory and organizations' | translate $}</h2>
                </div>
            </div>
            <div class="section_content_container org_user_admin container-fluid">
                <div class="section_content row">
                    <div class="table_list_container remove_buildings_table col-sm-5">
                        <table id="admin-organizations-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th translate>Parent ID</th>
                                    <th translate>ID</th>
                                    <th translate>Organization</th>
                                    <th translate>Created</th>
                                    <th translate>User Count</th>
                                    <th translate>Property Count</th>
                                    <th translate>Tax Lot Count</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="org in org_user.organizations">
                                    <td>{$:: org.parent_id !== org.org_id ? org.parent_id : '' $}</td>
                                    <td>{$:: org.org_id $}</td>
                                    <td>{$:: org.name $}</td>
                                    <td>{$:: org.created $}</td>
                                    <td>{$ org.number_of_users | number:0 $}</td>
                                    <td>
                                        <div ng-repeat="cycle in ::org.cycles" ng-if="::cycle.num_properties">
                                            {$:: cycle.name $}: {$:: cycle.num_properties $}
                                        </div>
                                    </td>
                                    <td>
                                        <div ng-repeat="cycle in ::org.cycles" ng-if="::cycle.num_taxlots">
                                            {$:: cycle.name $}: {$:: cycle.num_taxlots $}
                                        </div>
                                    </td>
                                    <td style="width: 470px;">
                                        <div>
                                            <button class="btn btn-default" ng-click="confirm_inventory_delete(org)" ng-disabled="org.progress > -1" translate>Remove Inventory</button>
                                            <button class="btn btn-warning" type="button" style="margin-left:10px;" ng-click="confirm_column_mappings_delete(org)" ng-disabled="org.progress > -1">
                                                <i class="fa fa-exclamation-triangle"></i> {$:: 'Remove Column Mappings' | translate $}
                                            </button>
                                            <button class="btn btn-danger" type="button" style="margin-left:10px;" ng-click="confirm_org_delete(org)" ng-disabled="org.progress > -1">
                                                <i class="fa fa-exclamation-triangle"></i> {$:: 'Delete Organization' | translate $}
                                            </button>
                                            <uib-progressbar class="progress-striped active" value="org.progress" type="success" ng-show="org.progress > -1">{$ org.remove_message | translate $}</uib-progressbar>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
